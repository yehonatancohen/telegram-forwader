services:
  telegram-intel:
    image: yehonatancohen/telegram-reporter:latest
    container_name: telegram-intel
    restart: unless-stopped
    env_file:
      - config.env
    volumes:
      - intel-data:/usr/src/app/data
      - ./arab_channels.txt:/usr/src/app/arab_channels.txt:ro
      - ./smart_channels.txt:/usr/src/app/smart_channels.txt:ro
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower-intel
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=300
      - WATCHTOWER_LABEL_ENABLE=false
    command: telegram-intel

  clearmap-brain:
    build:
      context: ./clearmap-brain
      dockerfile: Dockerfile
    container_name: clearmap-brain
    restart: unless-stopped
    volumes:
      - intel-data:/data:ro
      - ./clearmap-brain/serviceAccountKey.json:/app/serviceAccountKey.json:ro
    environment:
      - TELEGRAM_DB_PATH=/data/intel.db
      - SERVICE_ACCOUNT_FILE=/app/serviceAccountKey.json
    depends_on:
      - telegram-intel
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  intel-data:
